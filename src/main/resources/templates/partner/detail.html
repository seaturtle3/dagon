<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>파트너 상세</title>
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #f9fafb;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            margin-top: 60px;
            background-color: #ffffff;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
            max-width: 600px;
            width: 100%;
        }

        h2 {
            font-size: 26px;
            margin-bottom: 20px;
            color: #1f2937;
        }

        .detail-box p {
            margin-bottom: 12px;
            line-height: 1.6;
        }

        .detail-box strong {
            display: inline-block;
            width: 120px;
            color: #4b5563;
        }

        button {
            margin-top: 20px;
            margin-right: 10px;
            padding: 10px 18px;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        button:hover {
            opacity: 0.9;
        }

        button.approve {
            background-color: #10b981;
            color: white;
        }

        button.reject {
            background-color: #ef4444;
            color: white;
        }

        textarea {
            width: 100%;
            height: 80px;
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #d1d5db;
            resize: vertical;
            font-size: 14px;
        }

        #rejectionForm {
            margin-top: 20px;
            display: none;
        }

        .back-link {
            display: inline-block;
            margin-top: 30px;
            text-decoration: none;
            color: #3b82f6;
        }

        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>파트너 상세 정보</h2>
    <div class="detail-box">
        <p><strong>ID:</strong> <span th:text="${app.pid}"></span></p>
        <p><strong>상호명:</strong> <span th:text="${app.pname}"></span></p>
        <p><strong>대표자명:</strong> <span th:text="${app.ceoName}"></span></p>
        <p><strong>주소:</strong> <span th:text="${app.paddress}"></span></p>
        <p><strong>사업자 번호:</strong> <span th:text="${app.license}"></span></p>
        <p><strong>정보:</strong> <span th:text="${app.pinfo}"></span></p>
        <p><strong>상태:</strong> <span th:text="${app.pstatus}"></span></p>
        <p><strong>신청자:</strong> <span th:text="${app.uname}"></span></p>

        <button class="approve" th:onclick="|approve(${app.pid})|">심사 완료</button>
        <button class="reject" onclick="showRejectionForm()">반려</button>

        <div id="rejectionForm">
            <textarea id="rejectionReason" placeholder="반려 사유를 입력하세요"></textarea>
            <button class="reject" th:onclick="|reject(${app.pid})|">반려 확정</button>
        </div>
    </div>

    <a href="/partner/list" class="back-link">← 목록으로 돌아가기</a>
</div>

<script>
    function approve(pid) {
        if (confirm("심사 완료 처리하시겠습니까?")) {
            fetch(`/api/partner/approve/${pid}`, { method: "POST" })
                .then(res => {
                    if (res.ok) {
                        alert("심사가 완료되었습니다.");
                        window.location.href = "/partner/list";
                    } else {
                        alert("심사 처리 중 오류가 발생했습니다.");
                    }
                })
                .catch(() => alert("서버 에러가 발생했습니다."));
        }
    }

    function showRejectionForm() {
        document.getElementById("rejectionForm").style.display = "block";
    }

    function reject(pid) {
        const reason = document.getElementById("rejectionReason").value;
        if (!reason.trim()) {
            alert("반려 사유를 입력해주세요.");
            return;
        }

        fetch(`/api/partner/reject/${pid}`, {
            method: "POST",
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ reason: reason })
        }).then(res => {
            if (res.ok) {
                alert("반려 처리가 완료되었습니다.");
                window.location.href = "/partner/list";
            } else {
                alert("반려 처리 중 오류가 발생했습니다.");
            }
        }).catch(() => alert("서버 에러가 발생했습니다."));
    }
</script>

</body>
</html>
