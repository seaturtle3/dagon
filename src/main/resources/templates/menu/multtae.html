<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:insert="~{fragments/common_head :: head}">
    <meta charset="UTF-8">
    <title>물때 정보</title>

</head>
<style>

    h2 {
        font-size: 20px;
        margin-top: 30px;
    }

    h3 {
        margin: 0;
        font-size: 16px;
    }

    .region-wrapper {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        margin-bottom: 20px;
        align-items: flex-start;
    }

    .region-block {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }

    .station-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 6px;
    }

    button {
        padding: 6px 12px;
        font-size: 14px;
        border: 1px solid #ccc;
        background-color: #f9f9f9;
        cursor: pointer;
        border-radius: 4px;
        transition: background-color 0.2s;
    }

    button:hover {
        background-color: #dceeff;
    }

    .selected {
        background-color: #e0f0ff;
        font-weight: bold;
    }

    ul {
        padding-left: 20px;
    }

    li {
        margin-bottom: 8px;
        font-size: 15px;
    }
</style>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<h2>지역 선택</h2>

<div class="region-wrapper">
    <div th:each="entry : ${groupedStations}" class="region-block">
        <h3 th:text="${entry.key.korean}"></h3>
        <div class="station-buttons">
            <button th:each="station : ${entry.value}"
                    type="button"
                    th:text="${station.stationName}"
                    th:attr="data-code=${station.stationCode},data-region=${station.region}"
                    onclick="loadTideData(this)">
            </button>
        </div>
    </div>
</div>

<hr/>

<h2>물때 정보</h2>
<ul id="tideInfo">
    <li th:each="item : ${tideItems}">
        시각: <span th:text="${item.tph_time}"></span>,
        수위: <span th:text="${item.tph_level}"></span>,
        구분: <span th:text="${item.hl_code}"></span>
    </li>
</ul>

<hr/>

<h2 id="mulNameHeading" th:text="'오늘의 물때: ' + ${mulName}"></h2>


<script>
    function loadTideData(button) {
        const stationCode = button.getAttribute("data-code");
        const date = new Date().toISOString().slice(0, 10); // 오늘 날짜 YYYY-MM-DD


        document.querySelectorAll(".station-buttons button").forEach(btn => btn.classList.remove("selected"));
        button.classList.add("selected");

        fetch(`/api/multtae/daily?stationCode=${stationCode}&date=${date}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("데이터 요청 실패.");
                }
                return response.json();
            })
            .then(data => {

                renderTideInfo(data.tideItems);
                document.getElementById("mulNameHeading").textContent = `오늘의 물때: ${data.mulName}`;
            })
            .catch(err => {
                console.error(err);
                const container = document.getElementById("tideInfo");
                if (container) {
                    container.innerHTML = "<li>물때 정보를 불러올 수 없습니다.</li>";
                }
            });

    }


    function renderTideInfo(items) {
        const container = document.getElementById("tideInfo");
        container.innerHTML = "";
        items.forEach(item => {
            const li = document.createElement("li");
            li.textContent = `시각: ${item.tph_time}, 수위: ${item.tph_level}, 구분: ${item.hl_code}`;
            container.appendChild(li);
        });
    }


</script>
</body>
</html>