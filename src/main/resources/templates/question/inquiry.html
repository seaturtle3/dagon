<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>1:1 문의하기</title>
    <style>
        #boardList {
            display: none;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
        }

        .success-message {
            color: green;
        }

        .error-message {
            color: red;
        }
    </style>
</head>
<body>

<h2>1:1 문의</h2>
<hr>

<form id="inquiryForm" th:object="${inquiry}">
    <label>작성자 유형</label>
    <select name="userType" required>
        <option disabled selected value="">작성자 유형</option>
        <option th:each="type : ${writerTypes}"
                th:value="${type}"
                th:text="${type.korean}"></option>
    </select>
    <br>

    <label>문의 유형</label>
    <select name="inquiryType" required>
        <option disabled selected value="">문의 유형</option>
        <option th:each="type : ${inquiryTypes}"
                th:value="${type}"
                th:text="${type.korean}"></option>
    </select>
    <br>

    <label>받는 사람</label>
    <select name="receiverType" required>
        <option disabled selected value="">받는 사람</option>
        <option value="PARTNER">파트너</option>
        <option value="ADMIN">관리자</option>
    </select>
    <br>

    <label>작성자</label>
    <input type="text" name="writer" required/>
    <br>

    <label>연락처</label>
    <input type="text" name="contact" required/>
    <br>

    <label>제목</label>
    <input type="text" name="title" required/>
    <br>

    <label>내용</label>
    <textarea name="content" required></textarea>
    <br>

    <button type="button" onclick="submitInquiry()">문의하기</button>
</form>

<div id="messageBox"></div>

<!-- 문의 성공 시 나타나는 목록 -->
<div id="boardList">
    <h3>안내 사항</h3>
    <ul>
        <li>담당자가 신속하게 확인하여 안내드리겠습니다.<br>
        답변이 완료되면 고객님에게 알림 메시지를 보내드립니다.<br>
        정확한 답변을 위해 다소 시간이 소요될 수 있습니다.<br>
        잠시만 기다려 주십시오.<br>
            **긴급 문의 : 010-0000-0000**</li>
    </ul>


</div>
    <a href="/inquiry/list">
        <button type="button">목록으로</button>
    </a>

<script>
    async function submitInquiry() {
        const form = document.getElementById('inquiryForm');
        const formData = new FormData(form);

        const data = {};
        formData.forEach((value, key) => {
            data[key] = value;
        });

        const response = await fetch('/inquiry', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        const result = await response.json();
        const messageBox = document.getElementById('messageBox');

        if (result.success) {
            messageBox.innerHTML = '<p class="success-message">문의가 정상적으로 접수되었습니다.</p>';
            document.getElementById("boardList").style.display = "block";
        } else {
            messageBox.innerHTML = '<p class="error-message">문의 접수에 실패했습니다. 다시 시도해주세요.</p>';
        }
    }
</script>

</body>
</html>